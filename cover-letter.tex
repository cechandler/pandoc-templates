\documentclass[$if(font-size)$$fontsize$$else$11pt$endif$]{letter}
\usepackage[paper=letterpaper,top=1in,left=1in,right=1in,bottom=1in]{geometry}
\usepackage{graphicx,grffile}
% \usepackage{fontspec}
\newcommand{\mytilde}{\raise.17ex\hbox{$$\scriptstyle\mathtt{\sim}$$}}
\usepackage[absolute]{textpos}
\usepackage[percent]{overpic}
\setlength{\TPHorizModule}{8.5in}
\setlength{\TPVertModule}{\TPHorizModule}
\textblockorigin{1in}{1in} % start everything near the top-left corner

\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
$if(euro)$
  \usepackage{eurosym}
$endif$
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
    \usepackage{xltxtra,xunicode}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
  \newcommand{\euro}{â‚¬}
$if(mainfont)$
  \setmainfont{$mainfont$}
$endif$
$if(sansfont)$
  \setsansfont{$sansfont$}
$endif$
$if(monofont)$
  \setmonofont[Mapping=tex-ansi]{$monofont$}
$endif$
$if(mathfont)$
  \setmathfont(Digits,Latin,Greek){$mathfont$}
$endif$
\fi

\address{$for(return-address)$$return-address$$sep$\\$endfor$}

% ==================================================
% DOCUMENT BEGINS
% ==================================================

\begin{document}


$for(include-before)$
$include-before$
$endfor$

$if(letterhead)$
\begin{textblock}{0}(0,0)
$if(letterhead-scale)$\includegraphics[scale=$letterhead-scale$]{$letterhead$}
$else$\includegraphics[scale=0.13]{$letterhead$}
$endif$
\end{textblock}
$endif$

\begin{letter}{$for(address)$$address$$sep$\\$endfor$}

$if(date)$\date{$date$}$endif$

$if(opening)$\opening{$opening$}$endif$

$body$

$if(closing)$
$closing$
$endif$

$if(signature)$
$if(signature-before)$\vspace*{$signature-before$}$endif$
$if(signature-scale)$\includegraphics[scale=$signature-scale$]{$signature$}$else$\includegraphics[scale=0.20]{$signature$}$endif$
$if(signature-after)$\vspace*{$signature-after$}$endif$
$if(author)$$author$$endif$\\
$if(contact)$$for(contact)$$contact$$sep$\\$endfor$$endif$
$else$
$if(author)$$author$$endif$
$endif$

\end{letter}

$for(include-after)$
$include-after$
$endfor$

\end{document}
